<!DOCTYPE html>
<html>
<head>
  <title>Registro de Charcos</title>
  <script>
    // URL del Google Apps Script (reemplaza con tu URL)
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxsg0FWuWya0vbhLTQ5MN9I33gY5kDR3mQ_f790R9b1eYXGOAXxH2GIejgRb-Ro6D4j/exec';

    function registrarDatos() {
      navigator.geolocation.getCurrentPosition(function(position) {
        const latitud = position.coords.latitude;
        const longitud = position.coords.longitude;
        const fechaHora = new Date().toLocaleString();
        const datos = `${fechaHora}, teta, ${latitud}, ${longitud}`;

        // Guarda los datos en localStorage
        let registros = localStorage.getItem('registros');
        if (!registros) {
          registros = [];
        } else {
          registros = JSON.parse(registros);
        }
        registros.push(datos);
        localStorage.setItem('registros', JSON.stringify(registros));

        alert('Datos registrados correctamente.');
        window.location.reload();
      });
    }

    function mostrarDatos() {
      let registros = localStorage.getItem('registros');
      if (registros) {
        registros = JSON.parse(registros);
        const lista = document.getElementById('lista-registros');
        lista.innerHTML = '';
        registros.forEach((registro) => {
          const li = document.createElement('li');
          li.textContent = registro;
          lista.appendChild(li);
        });
      }
    }

    function enviarDatos() {
      if (navigator.onLine) {
        let registros = localStorage.getItem('registros');
        if (registros) {
          registros = JSON.parse(registros);
          registros.forEach((registro) => {
            fetch(SCRIPT_URL, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ data: registro }),
            }).then(response => response.text())
              .then(result => console.log('Data sent:', result))
              .catch(error => console.error('Error sending data:', error));
          });
          localStorage.removeItem('registros');
        }
      } else {
        console.log('No internet connection.');
      }
    }

    window.onload = function() {
      mostrarDatos();
      document.getElementById('registrar').onclick = registrarDatos;
      enviarDatos(); // Intentar enviar los datos cuando se carga la página
    };
  </script>
</head>
<body>
  <h1>Registro de Charcos</h1>
  <button id="registrar">Registrar Ubicación</button>
  <ul id="lista-registros"></ul>
</body>
</html>
