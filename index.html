<!DOCTYPE html>
<html>
<head>
  <title>Registro de Charcos</title>
  <script>
    // URL del PHP en tu servidor
    const PHP_URL = 'https://iassa-sa.com.ar/movilesapp/PWA/guardar_datos.php';

    function registrarDatos() {
      navigator.geolocation.getCurrentPosition(function(position) {
        const latitud = position.coords.latitude;
        const longitud = position.coords.longitude;
        const fechaHora = new Date().toLocaleString();
        const datos = {
          fechahora1: fechaHora,
          latitud: latitud,
          longitud: longitud,
          nombre: 'nombre',  // Ajusta esto según tus necesidades
          descripcion: 'descripcion'  // Ajusta esto según tus necesidades
        };

        // Guarda los datos en localStorage
        let registros = localStorage.getItem('registros');
        if (!registros) {
          registros = [];
        } else {
          registros = JSON.parse(registros);
        }
        registros.push(datos);
        localStorage.setItem('registros', JSON.stringify(registros));

        alert('Datos registrados correctamente.');
        window.location.reload();
      });
    }

    function mostrarDatos() {
      let registros = localStorage.getItem('registros');
      if (registros) {
        registros = JSON.parse(registros);
        const lista = document.getElementById('lista-registros');
        lista.innerHTML = '';
        registros.forEach((registro) => {
          const li = document.createElement('li');
          li.textContent = `${registro.fechahora1}, ${registro.latitud}, ${registro.longitud}`;
          lista.appendChild(li);
        });
      }
    }

    function enviarDatos() {
      if (navigator.onLine) {
        let registros = localStorage.getItem('registros');
        if (registros) {
          registros = JSON.parse(registros);
          registros.forEach((registro) => {
            fetch(PHP_URL, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/x-www-form-urlencoded'
              },
              body: new URLSearchParams(registro)
            })
            .then(response => response.text())
            .then(result => console.log('Data sent:', result))
            .catch(error => console.error('Error sending data:', error));
          });
          localStorage.removeItem('registros');
        }
      } else {
        console.log('No internet connection.');
      }
    }

    window.onload = function() {
      mostrarDatos();
      document.getElementById('registrar').onclick = registrarDatos;
      enviarDatos(); // Intentar enviar los datos cuando se carga la página
    };
  </script>
</head>
<body>
  <h1>Registro de Charcos</h1>
  <button id="registrar">Registrar Ubicación</button>
  <ul id="lista-registros"></ul>
</body>
</html>


