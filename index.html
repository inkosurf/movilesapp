<!DOCTYPE html>
<html>
<head>
  <title>Registro de Charcos</title>
  <script>
    async function registrarDatos() {
      navigator.geolocation.getCurrentPosition(function(position) {
        const latitud = position.coords.latitude;
        const longitud = position.coords.longitude;
        const fechaHora = new Date().toLocaleString();
        const datos = {
          fechahora1: fechaHora,
          latitud: latitud,
          longitud: longitud,
          nombre: 'teta'  // Ajusta esto según el valor de la zona
        };

        // Guarda los datos en localStorage
        let registros = localStorage.getItem('registros');
        if (!registros) {
          registros = [];
        } else {
          registros = JSON.parse(registros);
        }
        registros.push(datos);
        localStorage.setItem('registros', JSON.stringify(registros));

        alert('Datos registrados correctamente.');
        window.location.reload();
      });
    }

    function mostrarDatos() {
      let registros = localStorage.getItem('registros');
      if (registros) {
        registros = JSON.parse(registros);
        const lista = document.getElementById('lista-registros');
        lista.innerHTML = '';
        registros.forEach((registro) => {
          const li = document.createElement('li');
          li.textContent = `${registro.fechahora1}, ${registro.nombre}, ${registro.latitud}, ${registro.longitud}`;
          lista.appendChild(li);
        });
      }
    }

    async function guardarDatosEnArchivo() {
      let registros = localStorage.getItem('registros');
      if (registros) {
        registros = JSON.parse(registros);
        const texto = registros.map(registro => 
          `${registro.fechahora1}, ${registro.nombre}, ${registro.latitud}, ${registro.longitud}`
        ).join('\n');

        try {
          const fileHandle = await window.showSaveFilePicker({
            suggestedName: 'registros.txt',
            types: [{
              description: 'Text Files',
              accept: {'text/plain': ['.txt']}
            }]
          });

          const writableStream = await fileHandle.createWritable();
          await writableStream.write(texto);
          await writableStream.close();

          // Limpiar los registros después de guardar
          localStorage.removeItem('registros');
          alert('Datos guardados correctamente en el archivo.');
        } catch (error) {
          console.error('Error guardando el archivo:', error);
        }
      } else {
        console.log('No hay registros para guardar.');
      }
    }

    window.onload = function() {
      mostrarDatos();
      document.getElementById('registrar').onclick = registrarDatos;
      document.getElementById('guardar').onclick = guardarDatosEnArchivo;
    };
  </script>
</head>
<body>
  <h1>Registro de Charcos</h1>
  <button id="registrar">Registrar Ubicación</button>
  <button id="guardar">Guardar Datos en Archivo</button>
  <ul id="lista-registros"></ul>
</body>
</html>


